<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unstuck - æ‘†è„±å¡é¡¿</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* é¢å¤–çš„è‡ªå®šä¹‰æ ·å¼ */
        body {
            background-color: #0f172a; /* æ·±è“é»‘èƒŒæ™¯ */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            touch-action: manipulation; /* ä¼˜åŒ–è§¦å± */
        }
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.5s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        .breathing-btn {
            animation: breathe 3s infinite ease-in-out;
        }
        @keyframes breathe {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px 10px rgba(99, 102, 241, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }
    </style>
</head>
<body class="text-slate-200 h-screen overflow-hidden flex flex-col">

    <div id="app" class="h-full w-full flex flex-col relative p-6">

        <div v-if="!apiKey" class="absolute inset-0 z-50 bg-slate-900 flex flex-col items-center justify-center p-8 text-center">
            <h2 class="text-2xl font-bold mb-4 text-indigo-400">è®¾ç½® AI å¯†é’¥</h2>
            <p class="mb-6 text-slate-400 text-sm">ä½ çš„ Key ä»…å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•ä¸­é—´æœåŠ¡å™¨ã€‚</p>
            <input type="password" v-model="tempKey" placeholder="sk-..." class="w-full max-w-md p-4 rounded-lg bg-slate-800 border border-slate-700 text-white focus:outline-none focus:border-indigo-500 mb-4 transition-all">
            <button @click="saveKey" :disabled="!tempKey" class="w-full max-w-md bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-lg transition-colors disabled:opacity-50">
                å¼€å§‹ä½¿ç”¨
            </button>
        </div>

        <div class="flex justify-between items-center mb-4" v-if="apiKey">
            <div class="text-xs text-slate-500 font-mono">Unstuck v1.0</div>
            <button @click="resetApp" class="text-slate-500 hover:text-white text-sm">é‡ç½® / å›é¦–é¡µ</button>
        </div>

        <transition name="fade" mode="out-in">
            <div v-if="step === 'home'" class="flex-1 flex flex-col items-center justify-center text-center" key="home">
                <div class="mb-12 text-slate-400">
                    <p>è§‰å¾—ç´¯å—ï¼Ÿæ²¡å…³ç³»ã€‚</p>
                    <p>æˆ‘ä»¬åªåšä¸€ä»¶äº‹ã€‚</p>
                </div>
                <button @click="goToInput" class="breathing-btn w-64 h-64 rounded-full bg-gradient-to-br from-indigo-600 to-purple-700 text-white text-2xl font-bold flex items-center justify-center shadow-2xl">
                    æˆ‘å¡ä½äº†<br>å¸®å¸®æˆ‘
                </button>
                <div class="mt-12 opacity-50">
                    <button @click="clearKey" class="text-xs text-red-900">æ¸…é™¤ API Key</button>
                </div>
            </div>

            <div v-if="step === 'input'" class="flex-1 flex flex-col items-center justify-center max-w-lg mx-auto w-full" key="input">
                <h2 class="text-2xl font-bold mb-6 text-indigo-300">ä½ æƒ³åšä»€ä¹ˆï¼Œä½†åšä¸åˆ°ï¼Ÿ</h2>
                <textarea v-model="userTask" placeholder="æ¯”å¦‚ï¼šæˆ‘æƒ³æ´—æ¾¡ï¼Œä½†æˆ‘åŠ¨ä¸äº†... æˆ–è€…ï¼šæˆ‘æœ‰ä¸ªæŠ¥å‘Šè¦å†™..." class="w-full h-32 p-4 rounded-xl bg-slate-800 border border-slate-700 text-white focus:outline-none focus:border-indigo-500 mb-6 text-lg"></textarea>
                
                <div v-if="isLoading" class="flex flex-col items-center">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500 mb-4"></div>
                    <p class="text-slate-400 animate-pulse">æ­£åœ¨æ¸©æŸ”åœ°æ‹†è§£ä»»åŠ¡...</p>
                </div>

                <button v-else @click="getAiHelp" :disabled="!userTask" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed text-lg">
                    å¸®æˆ‘æ‹†è§£
                </button>
            </div>

            <div v-if="step === 'action'" class="flex-1 flex flex-col items-center justify-center max-w-lg mx-auto w-full text-center" key="action">
                
                <div class="w-full bg-slate-800 h-2 rounded-full mb-10 overflow-hidden">
                    <div class="bg-green-500 h-full transition-all duration-500" :style="{ width: progressPercentage + '%' }"></div>
                </div>

                <div class="mb-4 text-indigo-400 font-mono text-sm tracking-widest">STEP {{ currentStepIndex + 1 }} / {{ steps.length }}</div>
                
                <h2 class="text-3xl md:text-4xl font-bold mb-8 leading-tight text-white transition-all duration-300">
                    {{ steps[currentStepIndex] }}
                </h2>

                <p class="text-slate-500 mb-12 text-sm">åªéœ€åšè¿™è¿™ä¸€æ­¥ã€‚å…¶ä»–çš„å…ˆåˆ«æƒ³ã€‚</p>

                <button @click="completeStep" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-5 rounded-2xl text-xl shadow-lg transition-transform active:scale-95">
                    æˆ‘åšåˆ°äº†
                </button>
                
                <button @click="skipStep" class="mt-6 text-slate-500 hover:text-slate-300 text-sm">
                    è¿™æ­¥å¤ªéš¾äº†ï¼Œè·³è¿‡/å†æ‹†å°ç‚¹
                </button>
            </div>

            <div v-if="step === 'finish'" class="flex-1 flex flex-col items-center justify-center text-center" key="finish">
                <h2 class="text-4xl font-bold text-green-400 mb-6">å¤ªæ£’äº†ï¼ğŸ‰</h2>
                <p class="text-xl text-slate-300 mb-10">ä½ æˆ˜èƒœäº†é˜»åŠ›ã€‚å“ªæ€•åªæ˜¯å¼€å§‹ï¼Œä¹Ÿæ˜¯å·¨å¤§çš„èƒœåˆ©ã€‚</p>
                <button @click="resetApp" class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-8 rounded-lg">
                    ä¼‘æ¯ä¸€ä¸‹ / æ–°çš„ä»»åŠ¡
                </button>
            </div>
        </transition>

    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                // çŠ¶æ€ç®¡ç†
                const apiKey = ref(localStorage.getItem('openai_api_key') || '');
                const tempKey = ref('');
                const step = ref('home'); // home, input, action, finish
                const userTask = ref('');
                const isLoading = ref(false);
                const steps = ref([]);
                const currentStepIndex = ref(0);

                // ä¿å­˜ Key
                const saveKey = () => {
                    localStorage.setItem('openai_api_key', tempKey.value);
                    apiKey.value = tempKey.value;
                };

                // æ¸…é™¤ Key
                const clearKey = () => {
                    localStorage.removeItem('openai_api_key');
                    apiKey.value = '';
                    tempKey.value = '';
                };

                // å¯¼èˆªé€»è¾‘
                const goToInput = () => step.value = 'input';
                const resetApp = () => {
                    step.value = 'home';
                    userTask.value = '';
                    steps.value = [];
                    currentStepIndex.value = 0;
                };

                // æ ¸å¿ƒé€»è¾‘ï¼šè°ƒç”¨ AI
                const getAiHelp = async () => {
                    if (!userTask.value) return;
                    isLoading.value = true;

                    try {
                        const response = await fetch('https://api.openai.com/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${apiKey.value}`
                            },
                            body: JSON.stringify({
                                model: "gpt-4o-mini", // ä½¿ç”¨ mini æ¨¡å‹æ›´çœé’±ä¸”é€Ÿåº¦å¿«
                                messages: [
                                    {
                                        role: "system",
                                        content: `ä½ æ˜¯ä¸€ä¸ªé’ˆå¯¹å¤šåŠ¨ç—‡(ADHD)ã€æ‹–å»¶ç—‡å’Œç„¦è™‘ç—‡æ‚£è€…çš„è¾…åŠ©æ²»ç–—å¸ˆã€‚ä½ çš„ç›®æ ‡æ˜¯å¸®åŠ©ç”¨æˆ·å¯åŠ¨ä»»åŠ¡ã€‚
                                        ç”¨æˆ·ä¼šå‘Šè¯‰ä½ ä»–ä»¬æƒ³åšä»€ä¹ˆä½†æ— æ³•å¼€å§‹ã€‚
                                        ä½ éœ€è¦å°†ä»»åŠ¡æ‹†è§£ä¸º**æåº¦å¾®å°ã€å‡ ä¹ä¸éœ€è¦æ„å¿—åŠ›**çš„æ­¥éª¤ã€‚
                                        
                                        åŸåˆ™ï¼š
                                        1. ç¬¬ä¸€æ­¥å¿…é¡»æ˜¯ç‰©ç†ä¸Šçš„ã€æå…¶ç®€å•çš„åŠ¨ä½œï¼ˆä¾‹å¦‚ï¼šâ€œæŠŠæ‰‹æœºé”å±â€ã€â€œæ”¾ä¸‹é¥æ§å™¨â€ã€â€œç«™èµ·æ¥â€ï¼‰ã€‚
                                        2. æ­¥éª¤ä¸è¦è¶…è¿‡ 5-8 ä¸ªã€‚
                                        3. è¯­æ°”è¦æåº¦æ¸©æŸ”ã€å®½å®¹ï¼Œä¸è¦è¯´æ•™ã€‚
                                        4. å¿½ç•¥ä»»åŠ¡çš„å¤æ‚æ€§ï¼Œåªå…³æ³¨â€œå¯åŠ¨â€ã€‚
                                        
                                        **é‡è¦ï¼š** è¯·ä»…è¿”å›ä¸€ä¸ªçº¯ JSON æ•°ç»„ï¼ŒåŒ…å«æ­¥éª¤å­—ç¬¦ä¸²ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—ã€‚
                                        ä¾‹å¦‚ï¼š["æ·±å‘¼å¸ä¸€æ¬¡", "æ”¾ä¸‹æ‰‹æœº", "èµ°åˆ°æµ´å®¤é—¨å£", "æ‰“å¼€ç¯", "æ‰“å¼€æ°´é¾™å¤´"]`
                                    },
                                    {
                                        role: "user",
                                        content: userTask.value
                                    }
                                ]
                            })
                        });

                        const data = await response.json();
                        
                        if (data.error) {
                            alert("API Error: " + data.error.message);
                            isLoading.value = false;
                            return;
                        }

                        // è§£æè¿”å›çš„å†…å®¹
                        let content = data.choices[0].message.content;
                        // æ¸…ç†å¯èƒ½å­˜åœ¨çš„ markdown ä»£ç å—æ ‡è®°
                        content = content.replace(/```json/g, '').replace(/```/g, '');
                        
                        try {
                            steps.value = JSON.parse(content);
                            step.value = 'action';
                        } catch (e) {
                            console.error("JSON parse error", e);
                            alert("AI è¿”å›æ ¼å¼æœ‰è¯¯ï¼Œè¯·é‡è¯•ã€‚");
                        }

                    } catch (error) {
                        alert("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½® (å¯èƒ½éœ€è¦æ¢¯å­)ã€‚");
                        console.error(error);
                    } finally {
                        isLoading.value = false;
                    }
                };

                // å®Œæˆä¸€æ­¥
                const completeStep = () => {
                    // æ’’èŠ±ç‰¹æ•ˆ
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });

                    if (currentStepIndex.value < steps.value.length - 1) {
                        setTimeout(() => {
                            currentStepIndex.value++;
                        }, 500); // ç¨å¾®å»¶è¿Ÿä¸€ä¸‹åˆ‡æ¢
                    } else {
                        setTimeout(() => {
                            step.value = 'finish';
                        }, 1000);
                    }
                };
                
                // è·³è¿‡/ä¿®æ”¹
                const skipStep = () => {
                   if (currentStepIndex.value < steps.value.length - 1) {
                        currentStepIndex.value++;
                   } else {
                       step.value = 'finish';
                   }
                };

                const progressPercentage = computed(() => {
                    if (steps.value.length === 0) return 0;
                    return ((currentStepIndex.value) / steps.value.length) * 100;
                });

                return {
                    apiKey, tempKey, saveKey, clearKey,
                    step, userTask, isLoading,
                    steps, currentStepIndex,
                    goToInput, resetApp, getAiHelp,
                    completeStep, skipStep,
                    progressPercentage
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
